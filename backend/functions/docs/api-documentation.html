<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAI-SAAS API Documentation v2.0</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>üìö KAI-SAAS API Documentation</h1>
            <p>Cloud Functions para gesti√≥n de agentes de IA y autenticaci√≥n de usuarios</p>
            <p style="color: #666; font-size: 0.9em;">Versi√≥n 2.0 - Actualizado: 2025-12-04</p>
        </header>

        <div class="base-url">
            <h3>üåê Base URL</h3>
            <code>https://us-central1-asistente-comercial-8d43c.cloudfunctions.net</code>
        </div>

        <div class="security-note">
            <strong>üîê Autenticaci√≥n:</strong> Las APIs protegidas requieren un token JWT Bearer obtenido del endpoint
            <code>/login</code>.
            <br><br>
            <strong>Flujo:</strong>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li>Hacer login con <code>POST /login</code></li>
                <li>Obtener el token JWT de la respuesta</li>
                <li>Usar el token en el header: <code>Authorization: Bearer &lt;token&gt;</code></li>
            </ol>
        </div>

        <div class="controls">
            <button class="expand-all-btn" onclick="toggleAll(false)">üìñ Expandir Todas</button>
            <button class="expand-all-btn" onclick="toggleAll(true)">üìï Colapsar Todas</button>
        </div>

        <!-- ============================================================================ -->
        <!-- AUTHENTICATION APIS -->
        <!-- ============================================================================ -->

        <h2
            style="margin-top: 40px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
            üîê Authentication APIs
        </h2>

        <!-- LOGIN -->
        <div class="endpoint collapsed" id="endpoint-auth-1">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-auth-1')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method post">POST</span>
                    <h2 class="endpoint-title">/login</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Autentica un usuario con email y password. Retorna un token JWT que debe usarse en las dem√°s APIs
                    protegidas.
                </p>

                <h3>Request Body (JSON)</h3>
                <div class="code-block">
                    <pre>{
  "email": "usuario@example.com",
  "password": "password123"
}</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Login exitoso</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "message": "Login successful",
    "user": {
      "uid": "abc123...",
      "email": "usuario@example.com",
      "displayName": "Usuario Test",
      "emailVerified": true
    },
    "token": "eyJhbGciOiJSUzI1NiIsImtpZCI6Ij...",
    "refreshToken": "AOEOulZ...",
    "expiresIn": "3600"
  },
  "timestamp": "2025-12-04T16:00:00.000Z"
}</pre>
                    </div>
                </div>

                <div class="response-example">
                    <h4><span class="badge error">401 Unauthorized</span> Credenciales inv√°lidas</h4>
                    <div class="code-block">
                        <pre>{
  "success": false,
  "error": {
    "message": "Invalid email or password",
    "code": 401
  },
  "timestamp": "2025-12-04T16:00:00.000Z"
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- GET USER PROFILE -->
        <div class="endpoint collapsed" id="endpoint-auth-2">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-auth-2')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method get">GET</span>
                    <h2 class="endpoint-title">/getUserProfile üîí</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Obtiene el perfil completo del usuario autenticado.
                </p>

                <div class="security-note">
                    <strong>üîí Requiere autenticaci√≥n:</strong> Incluir header
                    <code>Authorization: Bearer &lt;token&gt;</code>
                </div>

                <h3>Headers</h3>
                <div class="code-block">
                    <pre>Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6Ij...</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Perfil obtenido</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "uid": "abc123...",
    "email": "usuario@example.com",
    "emailVerified": true,
    "displayName": "Usuario Test",
    "photoURL": "https://...",
    "createdAt": "2025-01-01T00:00:00.000Z",
    "lastSignIn": "2025-12-04T16:00:00.000Z"
  },
  "timestamp": "2025-12-04T16:00:00.000Z"
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPDATE PASSWORD -->
        <div class="endpoint collapsed" id="endpoint-auth-3">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-auth-3')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method post">POST</span>
                    <h2 class="endpoint-title">/updatePassword üîí</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Cambia la contrase√±a del usuario autenticado.
                </p>

                <div class="security-note">
                    <strong>üîí Requiere autenticaci√≥n:</strong> Incluir header
                    <code>Authorization: Bearer &lt;token&gt;</code>
                </div>

                <h3>Request Body (JSON)</h3>
                <div class="code-block">
                    <pre>{
  "newPassword": "nuevaPassword123"
}</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Contrase√±a actualizada</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "message": "Password updated successfully",
    "uid": "abc123..."
  },
  "timestamp": "2025-12-04T16:00:00.000Z"
}</pre>
                    </div>
                </div>

                <div class="response-example">
                    <h4><span class="badge error">400 Bad Request</span> Validaci√≥n fallida</h4>
                    <div class="code-block">
                        <pre>{
  "success": false,
  "error": {
    "message": "Validation failed",
    "code": 400,
    "validationErrors": [
      {
        "field": "newPassword",
        "message": "Password must be at least 6 characters"
      }
    ]
  },
  "timestamp": "2025-12-04T16:00:00.000Z"
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPDATE EMAIL -->
        <div class="endpoint collapsed" id="endpoint-auth-4">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-auth-4')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method post">POST</span>
                    <h2 class="endpoint-title">/updateEmail üîí</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Cambia el email del usuario autenticado. El nuevo email se marca como no verificado.
                </p>

                <div class="security-note">
                    <strong>üîí Requiere autenticaci√≥n:</strong> Incluir header
                    <code>Authorization: Bearer &lt;token&gt;</code>
                </div>

                <h3>Request Body (JSON)</h3>
                <div class="code-block">
                    <pre>{
  "newEmail": "nuevo@email.com"
}</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Email actualizado</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "message": "Email updated successfully. Please verify your new email.",
    "uid": "abc123...",
    "newEmail": "nuevo@email.com",
    "emailVerified": false
  },
  "timestamp": "2025-12-04T16:00:00.000Z"
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPDATE PROFILE -->
        <div class="endpoint collapsed" id="endpoint-auth-5">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-auth-5')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method put">PUT</span>
                    <h2 class="endpoint-title">/updateProfile üîí</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Actualiza datos del perfil del usuario (nombre, foto, tel√©fono). NO actualiza email ni password.
                </p>

                <div class="security-note">
                    <strong>üîí Requiere autenticaci√≥n:</strong> Incluir header
                    <code>Authorization: Bearer &lt;token&gt;</code>
                </div>

                <h3>Request Body (JSON)</h3>
                <div class="code-block">
                    <pre>{
  "displayName": "Nuevo Nombre",
  "photoURL": "https://example.com/photo.jpg",
  "phoneNumber": "+1234567890"
}</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Perfil actualizado</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "uid": "abc123...",
    "email": "usuario@example.com",
    "displayName": "Nuevo Nombre",
    "photoURL": "https://example.com/photo.jpg",
    "phoneNumber": "+1234567890",
    "updatedAt": "2025-12-04T16:00:00.000Z"
  },
  "timestamp": "2025-12-04T16:00:00.000Z"
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================================ -->
        <!-- AGENT MANAGEMENT APIS -->
        <!-- ============================================================================ -->

        <h2
            style="margin-top: 40px; padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 8px;">
            ü§ñ Agent Management APIs
        </h2>

        <!-- GET AGENTS BY USER ID -->
        <div class="endpoint collapsed" id="endpoint-1">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-1')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method get">GET</span>
                    <h2 class="endpoint-title">/getAgentsByUserId</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Obtiene todos los agentes asociados a un usuario desde la colecci√≥n
                    <code>usersBuilders/{userId}/agentDrafts</code>.
                </p>

                <h3>Par√°metros</h3>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Par√°metro</th>
                            <th>Tipo</th>
                            <th>Requerido</th>
                            <th>Descripci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>userId</code></td>
                            <td>string</td>
                            <td><span class="required">‚úÖ S√≠</span></td>
                            <td>ID del usuario propietario de los agentes</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Ejemplo de Request</h3>
                <div class="code-block">
                    <pre>GET /getAgentsByUserId?userId=q5ia05np1XNIGQr6KaigStsb0Fs1</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Respuesta exitosa</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "userId": "q5ia05np1XNIGQr6KaigStsb0Fs1",
    "agents": [
      {
        "id": "3b01d3b2-742e-4d80-85ff-8613eae9abc6",
        "name": "Agente de Ventas",
        "status": "active"
      }
    ],
    "total": 1
  }
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- GET AGENT BY ID -->
        <div class="endpoint collapsed" id="endpoint-2">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-2')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method get">GET</span>
                    <h2 class="endpoint-title">/getAgentById</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Obtiene un agente espec√≠fico con todos sus campos y los nombres de sus subcolecciones.
                </p>

                <h3>Par√°metros</h3>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Par√°metro</th>
                            <th>Tipo</th>
                            <th>Requerido</th>
                            <th>Descripci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>string</td>
                            <td><span class="required">‚úÖ S√≠</span></td>
                            <td>ID del agente</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Ejemplo de Request</h3>
                <div class="code-block">
                    <pre>GET /getAgentById?id=3b01d3b2-742e-4d80-85ff-8613eae9abc6</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Respuesta exitosa</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "id": "3b01d3b2-742e-4d80-85ff-8613eae9abc6",
    "name": "Agente de Ventas",
    "collections": [
      "chats", "knowledgeBase", "modifications",
      "properties", "sheets", "tools", "users"
    ]
  }
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- GET COLLECTION BY AGENT ID -->
        <div class="endpoint collapsed" id="endpoint-3">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-3')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method get">GET</span>
                    <h2 class="endpoint-title">/getCollectionByAgentId</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Obtiene todos los documentos de una colecci√≥n espec√≠fica de un agente.
                    <strong>Incluye validaci√≥n de seguridad</strong> para verificar que el agente pertenece al usuario.
                </p>

                <div class="security-note">
                    <strong>üß™ Modo Test:</strong> Usa <code>userId=testid</code> para saltarse la validaci√≥n de
                    seguridad durante desarrollo.
                </div>

                <h3>Par√°metros</h3>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Par√°metro</th>
                            <th>Tipo</th>
                            <th>Requerido</th>
                            <th>Descripci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>userId</code></td>
                            <td>string</td>
                            <td><span class="required">‚úÖ S√≠</span></td>
                            <td>ID del usuario (usa "testid" para testing)</td>
                        </tr>
                        <tr>
                            <td><code>agentId</code></td>
                            <td>string</td>
                            <td><span class="required">‚úÖ S√≠</span></td>
                            <td>ID del agente</td>
                        </tr>
                        <tr>
                            <td><code>collectionName</code></td>
                            <td>string</td>
                            <td><span class="required">‚úÖ S√≠</span></td>
                            <td>Nombre de la colecci√≥n</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Colecciones disponibles</h3>
                <div class="collections-list">
                    <span class="collection-tag">chats</span>
                    <span class="collection-tag">knowledgeBase</span>
                    <span class="collection-tag">modifications</span>
                    <span class="collection-tag">properties</span>
                    <span class="collection-tag">sheets</span>
                    <span class="collection-tag">tools</span>
                    <span class="collection-tag">users</span>
                </div>

                <h3>Ejemplo de Request (Modo Normal)</h3>
                <div class="code-block">
                    <pre>GET /getCollectionByAgentId?userId=q5ia05np1XNIGQr6KaigStsb0Fs1&agentId=3b01d3b2-742e-4d80-85ff-8613eae9abc6&collectionName=knowledgeBase</pre>
                </div>

                <h3>Ejemplo de Request (Modo Test)</h3>
                <div class="code-block">
                    <pre>GET /getCollectionByAgentId?userId=testid&agentId=3b01d3b2-742e-4d80-85ff-8613eae9abc6&collectionName=knowledgeBase</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Respuesta exitosa (con documentos)</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "userId": "testid",
    "agentId": "3b01d3b2-742e-4d80-85ff-8613eae9abc6",
    "collectionName": "knowledgeBase",
    "documents": [
      {
        "id": "doc1",
        "title": "Informaci√≥n del producto",
        "content": "Detalles..."
      }
    ],
    "total": 1,
    "path": "agent_configurations/3b01d3b2.../knowledgeBase"
  }
}</pre>
                    </div>
                </div>

                <div class="response-example">
                    <h4><span class="badge error">403 Forbidden</span> Acceso denegado</h4>
                    <div class="code-block">
                        <pre>{
  "success": false,
  "error": "Access denied: Agent does not belong to this user"
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPDATE AGENT -->
        <div class="endpoint collapsed" id="endpoint-4">
            <div class="endpoint-header" onclick="toggleEndpoint('endpoint-4')">
                <span class="collapse-icon">‚ñº</span>
                <div class="endpoint-header-content">
                    <span class="method post">POST</span>
                    <h2 class="endpoint-title">/updateAgent</h2>
                </div>
            </div>
            <div class="endpoint-content">
                <p class="description">
                    Actualiza los campos de un agente existente.
                </p>

                <h3>Request Body (JSON)</h3>
                <div class="code-block">
                    <pre>{
  "agentId": "3b01d3b2-742e-4d80-85ff-8613eae9abc6",
  "updates": {
    "name": "Nuevo nombre",
    "description": "Nueva descripci√≥n",
    "status": "active"
  }
}</pre>
                </div>

                <div class="response-example">
                    <h4><span class="badge success">200 OK</span> Respuesta exitosa</h4>
                    <div class="code-block">
                        <pre>{
  "success": true,
  "data": {
    "message": "Agent updated successfully"
  }
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>üìù √öltima actualizaci√≥n: 2025-12-04</p>
            <p>Para m√°s informaci√≥n, consulta <code>docs/API-README.md</code> o <code>docs/api-documentation.yaml</code>
            </p>
        </footer>
    </div>

    <script>
        // Toggle individual endpoint
        function toggleEndpoint(id) {
            const endpoint = document.getElementById(id);
            endpoint.classList.toggle('collapsed');
        }

        // Toggle all endpoints
        function toggleAll(collapse) {
            const endpoints = document.querySelectorAll('.endpoint');
            endpoints.forEach(endpoint => {
                if (collapse) {
                    endpoint.classList.add('collapsed');
                } else {
                    endpoint.classList.remove('collapsed');
                }
            });
        }

        // Expand first endpoint by default on load
        window.addEventListener('DOMContentLoaded', () => {
            const firstEndpoint = document.getElementById('endpoint-auth-1');
            if (firstEndpoint) {
                firstEndpoint.classList.remove('collapsed');
            }
        });
    </script>
</body>

</html>